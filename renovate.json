{
    "$schema": "https://docs.renovatebot.com/renovate-schema.json",
    "extends": ["config:recommended"],
    "lockFileMaintenance": {
        "enabled": true
    },
    "nix": {
        "enabled": true
    },
    "pinDigests": true,
    "digest": {
        "dependencyDashboardApproval": true
    },
    "osvVulnerabilityAlerts": true,
    "vulnerabilityAlerts": {
        "enabled": true
    },
    "reviewers": ["xgroleau"],
    "platformAutomerge": true,
    "customManagers": [
        {
            "customType": "regex",
            "managerFilePatterns": ["/^.*\\.nix$/"],
            "matchStrings": [
                "\\w*image\\s*=\\s*\"(?<depName>[^\\n\\r:]+):(?<currentValue>[^\\n\\r@\"]+)(?:@(?<currentDigest>sha256:[a-f0-9]+))?\"",
                "\\w*Image\\s*=\\s*\"(?<depName>[^\\n\\r:]+):(?<currentValue>[^\\n\\r@\"]+)(?:@(?<currentDigest>sha256:[a-f0-9]+))?\""
            ],
            "datasourceTemplate": "docker"
        }
    ],
    "packageRules": [
        {
            "description": "Auto merge Docker digest updates (only docker, we don't want to update flakes digest)",
            "matchDatasources": ["docker"],
            "matchUpdateTypes": ["digest"],
            "dependencyDashboardApproval": false,
            "automerge": true,
            "automergeType": "pr"
        },
        {
            "enabled": false,
            "description": "Freeze DB images to tag (allow only digest/security)",
            "matchUpdateTypes": ["major", "minor", "patch"],
            "matchPackageNames": [
                "/postgres/",
                "/mysql/",
                "/mariadb/",
                "/mongodb/",
                "/pgvecto-rs/"
            ]
        }
    ]
}
